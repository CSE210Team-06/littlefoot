"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("@pacote/get-style"),e=require("@pacote/pixels"),n=require("@pacote/throttle"),r=function(){return r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},r.apply(this,arguments)};function i(t,e){t.classList.add(e)}function o(t,e){t.classList.remove(e)}function u(t,e){return t.classList.contains(e)}"function"==typeof SuppressedError&&SuppressedError;var a="littlefoot__tooltip";function c(e){var n=Number.parseFloat(t.getStyle(e,"marginLeft")),r=e.offsetWidth-n;return(e.getBoundingClientRect().left+r/2)/window.innerWidth}function l(e,n,r){var u=function(e,n){var r=Number.parseInt(t.getStyle(n,"marginTop"),10),i=2*r+n.offsetHeight,o=e.getBoundingClientRect().top+e.offsetHeight/2,u=window.innerHeight-o;return u>=i||u>=o?["below",u-r-15]:["above",o-r-15]}(n,e),a=u[0],l=u[1];if(r!==a){o(e,"is-"+r),i(e,"is-"+a);var s=100*c(n)+"%",f="above"===a?"100%":"0";e.style.transformOrigin=s+" "+f}return[a,l]}var s="is-active",f="is-changing",d="is-scrollable";function v(n){var r=n.id,v=n.button,p=n.content,m=n.host,h=n.popover,g=n.wrapper,y=0,b="above",w=function(){return document.body.contains(h)};return{id:r,activate:function(n){var r;v.setAttribute("aria-expanded","true"),i(v,f),i(v,s),v.insertAdjacentElement("afterend",h),h.style.maxWidth=document.body.clientWidth+"px",r=p,y=Math.round(e.pixels(t.getStyle(r,"maxHeight"),r)),null==n||n(h,v)},dismiss:function(t){v.setAttribute("aria-expanded","false"),i(v,f),o(v,s),o(h,s),null==t||t(h,v)},isActive:function(){return u(v,s)},isReady:function(){return!u(v,f)},ready:function(){i(h,s),o(v,f)},remove:function(){h.remove(),o(v,f)},reposition:function(){if(w()){var t=l(h,v,b),e=t[0],n=t[1];b=e,p.style.maxHeight=Math.min(y,n)+"px",h.offsetHeight<p.scrollHeight?(i(h,d),p.setAttribute("tabindex","0")):(o(h,d),p.removeAttribute("tabindex"))}},resize:function(){w()&&(h.style.left=function(e,n){var r=e.offsetWidth;return-c(n)*r+Number.parseInt(t.getStyle(n,"marginLeft"),10)+n.offsetWidth/2}(p,v)+"px",g.style.maxWidth=p.offsetWidth+"px",function(t,e){var n=t.querySelector("."+a);n&&(n.style.left=100*c(e)+"%")}(h,v))},destroy:function(){return m.remove()}}}var p="is-fully-scrolled",m=function(t){return function(e){var n=e.currentTarget,r=-e.deltaY;if(r>0&&o(t,p),n){if(n.scrollHeight>n.clientHeight){var u=window.innerHeight-40;Math.min(n.scrollHeight,u),t.style.maxHeight="".concat(Math.min(n.scrollHeight,.9*window.innerHeight),"px")}else t.style.maxHeight="auto",o(t,p);r<=0&&r<n.clientHeight+n.scrollTop-n.scrollHeight&&i(t,p)}}};var h="littlefoot__content",g="littlefoot__wrapper",y="littlefoot--print",b=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.forEach((function(t){return i(t,y)}))};function w(t,e){return Array.from(t.querySelectorAll(e))}function x(t,e){return t.querySelector("."+e)||t.firstElementChild||t}function E(t){var e=document.createElement("div");e.innerHTML=t;var n=e.firstElementChild;return n.remove(),n}function H(t){return void 0!==t}function S(t){var e=t.parentElement,n=w(e,":scope > :not(."+y+")"),r=n.filter((function(t){return"HR"===t.tagName}));n.length===r.length&&(b.apply(void 0,r.concat(e)),S(e))}function A(t,e){var n=t.parentElement;t.remove(),n&&n!==e&&!n.innerHTML.replace(/(\[\]|&nbsp;|\s)/g,"")&&A(n,e)}function D(t,e){var n=t[0],r=t[1],i=t[2],o=E(i.outerHTML);w(o,'[href$="#'+n+'"]').forEach((function(t){return A(t,o)}));var u=o.innerHTML.trim();return[r,i,{id:String(e+1),number:e+1,reference:"lf-"+n,content:u.startsWith("<")?u:"<p>"+u+"</p>"}]}function T(t){return function(e){return t.replace(/<%=?\s*(\w+?)\s*%>/g,(function(t,n){var r;return String(null!==(r=e[n])&&void 0!==r?r:"")}))}}function M(t,e){var r=T(t),i=T(e);return function(t){var e=t[0],o=t[1],u=o.id,a=E('<span class="littlefoot">'+r(o)+"</span>"),c=a.firstElementChild;c.setAttribute("aria-expanded","false"),c.dataset.footnoteButton="",c.dataset.footnoteId=u;var l=E(i(o));l.dataset.footnotePopover="",l.dataset.footnoteId=u;var s=x(l,g),f=x(l,h);return function(t,e){t.addEventListener("wheel",n.throttle(m(e),16))}(f,l),e.insertAdjacentElement("beforebegin",a),{id:u,button:c,host:a,popover:l,content:f,wrapper:s}}}function O(t){var e,n,i,u=t.allowDuplicates,a=t.anchorParentSelector,c=t.anchorPattern,l=t.buttonTemplate,s=t.contentTemplate,f=t.footnoteSelector,d=t.numberResetSelector,p=t.scope,m=function(t,e,n){return w(t,n+' a[href*="#"]').filter((function(t){return(t.href+t.rel).match(e)}))}(document,c,p).map(function(t,e,n,r){var i=[];return function(o){var u,a=o.href.split("#")[1];if(a){var c=null===(u=w(t,"#"+window.CSS.escape(a)).find((function(t){return e||!i.includes(t)})))||void 0===u?void 0:u.closest(r);if(c){i.push(c);var l=o.closest(n)||o;return[l.id||o.id,l,c]}}}}(document,u,a,f)).filter(H).map(D).map(d?(e=d,n=0,i=null,function(t){var o=t[0],u=t[1],a=t[2],c=o.closest(e);return n=i===c?n+1:1,i=c,[o,u,r(r({},a),{number:n})]}):function(t){return t}).map((function(t){var e=t[0],n=t[1],r=t[2];return b(e,n),S(n),[e,r]})).map(M(l,s)).map(v);return{footnotes:m,unmount:function(){m.forEach((function(t){return t.destroy()})),w(document,"."+y).forEach((function(t){return o(t,y)}))}}}var _="[data-footnote-id]",L=function(t,e){return t.target.closest(e)},C=function(t){return null==t?void 0:t.dataset.footnoteId},R=function(t){return function(e){e.preventDefault();var n=L(e,_),r=C(n);r&&t(r)}},W=document.addEventListener,k=window.addEventListener,P=function(t,e,n,r){return W(t,(function(t){var r=t.target;(null==r?void 0:r.closest(e))&&n.call(r,t)}),r)};var q={activateDelay:100,activateOnHover:!1,allowDuplicates:!0,allowMultiple:!1,anchorParentSelector:"sup",anchorPattern:/(fn|footnote|note)[:\-_\d]/gi,dismissDelay:100,dismissOnUnhover:!1,dismissOnDocumentTouch:!0,footnoteSelector:"li",hoverDelay:250,numberResetSelector:"",scope:"",contentTemplate:'<aside class="littlefoot__popover" id="fncontent:<% id %>"><div class="'.concat(g,'"><div class="').concat(h,'"><% content %></div></div><div class="').concat(a,'"></div></aside>'),buttonTemplate:'<button class="littlefoot__button" id="<% reference %>" title="See Footnote <% number %>"><svg role="img" aria-labelledby="title-<% reference %>" viewbox="0 0 31 6" preserveAspectRatio="xMidYMid"><title id="title-<% reference %>">Footnote <% number %></title><circle r="3" cx="3" cy="3" fill="white"></circle><circle r="3" cx="15" cy="3" fill="white"></circle><circle r="3" cx="27" cy="3" fill="white"></circle></svg></button>'};function z(t){void 0===t&&(t={});var e=r(r({},q),t),i=function(t,e){var n,r=t.footnotes,i=t.unmount,o=function(t){return function(n){n.isReady()&&(n.dismiss(e.dismissCallback),setTimeout(n.remove,t))}},u=function(t){return function(n){e.allowMultiple||r.filter((function(t){return t.id!==n.id})).forEach(o(e.dismissDelay)),n.isReady()&&(n.activate(e.activateCallback),n.reposition(),n.resize(),setTimeout(n.ready,t))}},a=function(t){return function(e){var n=r.find((function(t){return t.id===e}));n&&t(n)}},c=function(){return r.forEach(o(e.dismissDelay))};return{activate:function(t,e){return a(u(e))(t)},dismiss:function(t,e){return a(o(e))(t)},dismissAll:c,touchOutside:function(){e.dismissOnDocumentTouch&&c()},repositionAll:function(){return r.forEach((function(t){return t.reposition()}))},resizeAll:function(){return r.forEach((function(t){return t.resize()}))},toggle:a((function(t){return t.isActive()?o(e.dismissDelay)(t):u(e.activateDelay)(t)})),hover:a((function(t){n=t.id,e.activateOnHover&&!t.isActive()&&u(e.hoverDelay)(t)})),unhover:a((function(t){t.id===n&&(n=null),e.dismissOnUnhover&&setTimeout((function(){return r.filter((function(t){return t.id!==n})).forEach(o(e.dismissDelay))}),e.hoverDelay)})),unmount:i}}(O(e),e),o=function(t){var e=function(e){var n=L(e,"[data-footnote-button]"),r=C(n);r?(e.preventDefault(),t.toggle(r)):L(e,"[data-footnote-popover]")||t.touchOutside()},r=n.throttle(t.repositionAll,16),i=n.throttle(t.resizeAll,16),o=R(t.hover),u=R(t.unhover),a=new AbortController,c={signal:a.signal};return W("touchend",e,c),W("click",e,c),W("keyup",(function(e){27!==e.keyCode&&"Escape"!==e.key&&"Esc"!==e.key||t.dismissAll()}),c),W("gestureend",r,c),k("scroll",r,c),k("resize",i,c),P("mouseover",_,o,c),P("mouseout",_,u,c),function(){a.abort()}}(i);return{activate:function(t,n){void 0===n&&(n=e.activateDelay),i.activate(t,n)},dismiss:function(t,n){void 0===n&&(n=e.dismissDelay),void 0===t?i.dismissAll():i.dismiss(t,n)},unmount:function(){o(),i.unmount()},getSetting:function(t){return e[t]},updateSetting:function(t,n){e[t]=n}}}exports.default=z,exports.littlefoot=z;
//# sourceMappingURL=littlefoot.cjs.js.map
