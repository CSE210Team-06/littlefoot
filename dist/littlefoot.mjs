import{getStyle as t}from"@pacote/get-style";import{pixels as e}from"@pacote/pixels";import{throttle as n}from"@pacote/throttle";function o(t,e){t.classList.add(e)}function i(t,e){t.classList.remove(e)}function s(t,e){return t.classList.contains(e)}const r="littlefoot__tooltip";function l(e){const n=Number.parseFloat(t(e,"marginLeft")),o=e.offsetWidth-n;return(e.getBoundingClientRect().left+o/2)/window.innerWidth}function c(e,n,s){const[r,c]=function(e,n){const o=Number.parseInt(t(n,"marginTop"),10),i=2*o+n.offsetHeight,s=e.getBoundingClientRect().top+e.offsetHeight/2,r=window.innerHeight-s;return r>=i||r>=s?["below",r-o-15]:["above",s-o-15]}(n,e);if(s!==r){i(e,"is-"+s),o(e,"is-"+r);const t=100*l(n)+"%",c="above"===r?"100%":"0";e.style.transformOrigin=t+" "+c}return[r,c]}const a="is-active",u="is-changing",d="is-scrollable";function f({id:n,button:f,content:m,host:p,popover:h,wrapper:v}){let g=0,b="above";const y=()=>document.body.contains(h);return{id:n,activate:n=>{var i;f.setAttribute("aria-expanded","true"),o(f,u),o(f,a),f.insertAdjacentElement("afterend",h),h.style.maxWidth=document.body.clientWidth+"px",i=m,g=Math.round(e(t(i,"maxHeight"),i)),null==n||n(h,f)},dismiss:t=>{f.setAttribute("aria-expanded","false"),o(f,u),i(f,a),i(h,a),null==t||t(h,f)},isActive:()=>s(f,a),isReady:()=>!s(f,u),ready:()=>{o(h,a),i(f,u)},remove:()=>{h.remove(),i(f,u)},reposition:()=>{if(y()){const[t,e]=c(h,f,b);b=t,m.style.maxHeight=Math.min(g,e)+"px",h.offsetHeight<m.scrollHeight?(o(h,d),m.setAttribute("tabindex","0")):(i(h,d),m.removeAttribute("tabindex"))}},resize:()=>{y()&&(h.style.left=function(e,n){const o=e.offsetWidth;return-l(n)*o+Number.parseInt(t(n,"marginLeft"),10)+n.offsetWidth/2}(m,f)+"px",v.style.maxWidth=m.offsetWidth+"px",function(t,e){const n=t.querySelector("."+r);n&&(n.style.left=100*l(e)+"%")}(h,f))},destroy:()=>p.remove()}}const m="is-fully-scrolled",p=t=>e=>{const n=e.currentTarget,s=-e.deltaY;if(s>0&&i(t,m),n){if(n.scrollHeight>n.clientHeight){const e=20,o=window.innerHeight-2*e;Math.min(n.scrollHeight,o),t.style.maxHeight=`${Math.min(n.scrollHeight,.9*window.innerHeight)}px`}else t.style.maxHeight="auto",i(t,m);s<=0&&s<n.clientHeight+n.scrollTop-n.scrollHeight&&o(t,m)}};const h="littlefoot__content",v="littlefoot__wrapper",g="littlefoot--print",b=(...t)=>t.forEach((t=>o(t,g)));function y(t,e){return Array.from(t.querySelectorAll(e))}function w(t,e){return t.querySelector("."+e)||t.firstElementChild||t}function H(t){const e=document.createElement("div");e.innerHTML=t;const n=e.firstElementChild;return n.remove(),n}function x(t){return void 0!==t}function E(t){const e=t.parentElement,n=y(e,":scope > :not(."+g+")"),o=n.filter((t=>"HR"===t.tagName));n.length===o.length&&(b(...o.concat(e)),E(e))}function A(t,e){const n=t.parentElement;t.remove(),n&&n!==e&&!n.innerHTML.replace(/(\[\]|&nbsp;|\s)/g,"")&&A(n,e)}function D([t,e,n],o){const i=H(n.outerHTML);y(i,'[href$="#'+t+'"]').forEach((t=>A(t,i)));const s=i.innerHTML.trim();return[e,n,{id:String(o+1),number:o+1,reference:"lf-"+t,content:s.startsWith("<")?s:"<p>"+s+"</p>"}]}function S(t){return e=>t.replace(/<%=?\s*(\w+?)\s*%>/g,((t,n)=>{var o;return String(null!==(o=e[n])&&void 0!==o?o:"")}))}function T(t,e){const o=S(t),i=S(e);return([t,e])=>{const s=e.id,r=H('<span class="littlefoot">'+o(e)+"</span>"),l=r.firstElementChild;l.setAttribute("aria-expanded","false"),l.dataset.footnoteButton="",l.dataset.footnoteId=s;const c=H(i(e));c.dataset.footnotePopover="",c.dataset.footnoteId=s;const a=w(c,v),u=w(c,h);return function(t,e){t.addEventListener("wheel",n(p(e),16))}(u,c),t.insertAdjacentElement("beforebegin",r),{id:s,button:l,host:r,popover:c,content:u,wrapper:a}}}function O({allowDuplicates:t,anchorParentSelector:e,anchorPattern:n,buttonTemplate:o,contentTemplate:s,footnoteSelector:r,numberResetSelector:l,scope:c}){const a=function(t,e,n){return y(t,n+' a[href*="#"]').filter((t=>(t.href+t.rel).match(e)))}(document,n,c).map(function(t,e,n,o){const i=[];return s=>{var r;const l=s.href.split("#")[1];if(!l)return;const c=null===(r=y(t,"#"+window.CSS.escape(l)).find((t=>e||!i.includes(t))))||void 0===r?void 0:r.closest(o);if(!c)return;i.push(c);const a=s.closest(n)||s;return[a.id||s.id,a,c]}}(document,t,e,r)).filter(x).map(D).map(l?function(t){let e=0,n=null;return([o,i,s])=>{const r=o.closest(t);return e=n===r?e+1:1,n=r,[o,i,Object.assign(Object.assign({},s),{number:e})]}}(l):t=>t).map((([t,e,n])=>(b(t,e),E(e),[t,n]))).map(T(o,s)).map(f);return{footnotes:a,unmount(){a.forEach((t=>t.destroy())),y(document,"."+g).forEach((t=>i(t,g)))}}}const L="[data-footnote-id]",M=(t,e)=>t.target.closest(e),_=t=>null==t?void 0:t.dataset.footnoteId,C=t=>e=>{e.preventDefault();const n=M(e,L),o=_(n);o&&t(o)},R=document.addEventListener,W=window.addEventListener,k=(t,e,n,o)=>R(t,(t=>{const o=t.target;(null==o?void 0:o.closest(e))&&n.call(o,t)}),o);const j={activateDelay:100,activateOnHover:!1,allowDuplicates:!0,allowMultiple:!1,anchorParentSelector:"sup",anchorPattern:/(fn|footnote|note)[:\-_\d]/gi,dismissDelay:100,dismissOnUnhover:!1,dismissOnDocumentTouch:!0,footnoteSelector:"li",hoverDelay:250,numberResetSelector:"",scope:"",contentTemplate:`<aside class="littlefoot__popover" id="fncontent:<% id %>"><div class="${v}"><div class="${h}"><% content %></div></div><div class="${r}"></div></aside>`,buttonTemplate:'<button class="littlefoot__button" id="<% reference %>" title="See Footnote <% number %>"><svg role="img" aria-labelledby="title-<% reference %>" viewbox="0 0 31 6" preserveAspectRatio="xMidYMid"><title id="title-<% reference %>">Footnote <% number %></title><circle r="3" cx="3" cy="3" fill="white"></circle><circle r="3" cx="15" cy="3" fill="white"></circle><circle r="3" cx="27" cy="3" fill="white"></circle></svg></button>'};function z(t={}){const e=Object.assign(Object.assign({},j),t),o=function({footnotes:t,unmount:e},n){let o;const i=t=>e=>{e.isReady()&&(e.dismiss(n.dismissCallback),setTimeout(e.remove,t))},s=e=>o=>{n.allowMultiple||t.filter((t=>t.id!==o.id)).forEach(i(n.dismissDelay)),o.isReady()&&(o.activate(n.activateCallback),o.reposition(),o.resize(),setTimeout(o.ready,e))},r=e=>n=>{const o=t.find((t=>t.id===n));o&&e(o)},l=()=>t.forEach(i(n.dismissDelay));return{activate:(t,e)=>r(s(e))(t),dismiss:(t,e)=>r(i(e))(t),dismissAll:l,touchOutside:()=>{n.dismissOnDocumentTouch&&l()},repositionAll:()=>t.forEach((t=>t.reposition())),resizeAll:()=>t.forEach((t=>t.resize())),toggle:r((t=>t.isActive()?i(n.dismissDelay)(t):s(n.activateDelay)(t))),hover:r((t=>{o=t.id,n.activateOnHover&&!t.isActive()&&s(n.hoverDelay)(t)})),unhover:r((e=>{e.id===o&&(o=null),n.dismissOnUnhover&&setTimeout((()=>t.filter((t=>t.id!==o)).forEach(i(n.dismissDelay))),n.hoverDelay)})),unmount:e}}(O(e),e),i=function(t){const e=e=>{const n=M(e,"[data-footnote-button]"),o=_(n);o?(e.preventDefault(),t.toggle(o)):M(e,"[data-footnote-popover]")||t.touchOutside()},o=n(t.repositionAll,16),i=n(t.resizeAll,16),s=C(t.hover),r=C(t.unhover),l=new AbortController,c={signal:l.signal};return R("touchend",e,c),R("click",e,c),R("keyup",(e=>{27!==e.keyCode&&"Escape"!==e.key&&"Esc"!==e.key||t.dismissAll()}),c),R("gestureend",o,c),W("scroll",o,c),W("resize",i,c),k("mouseover",L,s,c),k("mouseout",L,r,c),()=>{l.abort()}}(o);return{activate(t,n=e.activateDelay){o.activate(t,n)},dismiss(t,n=e.dismissDelay){void 0===t?o.dismissAll():o.dismiss(t,n)},unmount(){i(),o.unmount()},getSetting:t=>e[t],updateSetting(t,n){e[t]=n}}}export{z as default,z as littlefoot};
//# sourceMappingURL=littlefoot.mjs.map
